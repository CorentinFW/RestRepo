================================================================================
          RAPPORT DE PROJET : SYSTÃˆME DE RÃ‰SERVATION HÃ”TELIÃˆRE
                      ARCHITECTURE REST SPRING BOOT
================================================================================

Auteur    : Corentin FAY
Date      : 29 Novembre 2025
Version   : 2.0 (REST)
Langue    : Java / Spring Boot
Framework : REST API + H2 Database + Swing GUI

================================================================================


1. LE PROJET
================================================================================

1.1 Mise en contexte
--------------------

Ce projet implÃ©mente un systÃ¨me de rÃ©servation d'hÃ´tels multi-agences basÃ© sur
une architecture REST moderne. Le systÃ¨me permet Ã  des clients de rechercher et
rÃ©server des chambres d'hÃ´tel en passant par des agences qui agrÃ¨gent les
offres de plusieurs Ã©tablissements.

L'architecture distribuÃ©e repose sur trois types d'acteurs :
  - Les HÃ”TELS : gÃ¨rent leurs chambres et rÃ©servations de maniÃ¨re autonome
  - Les AGENCES : agrÃ¨gent les offres de plusieurs hÃ´tels avec leurs propres
                   coefficients tarifaires
  - Le CLIENT : interface graphique (Swing) permettant de rechercher et rÃ©server

Le projet a Ã©tÃ© initialement dÃ©veloppÃ© en SOAP avant d'Ãªtre migrÃ© vers REST,
conservant la mÃªme logique mÃ©tier tout en modernisant les communications.


1.2 Les technologies et les idÃ©es
----------------------------------

Technologies principales :
  âœ“ Java 11+ : Langage de programmation principal
  âœ“ Spring Boot 2.7.18 : Framework d'application
  âœ“ Maven : Gestion des dÃ©pendances et compilation
  âœ“ H2 Database : Base de donnÃ©es embarquÃ©e persistante
  âœ“ Spring Data JPA : ORM pour la persistance
  âœ“ RestTemplate : Client REST pour les communications inter-services
  âœ“ Javax Swing : Interface graphique utilisateur
  âœ“ Swagger/OpenAPI : Documentation automatique des APIs

Architecture REST :

  - APIs RESTful suivant les principes HTTP (GET, POST, PUT, DELETE)
  - Format JSON pour l'Ã©change de donnÃ©es
  - Annotations Spring (@RestController, @RequestMapping, etc.)
  - DTOs (Data Transfer Objects) pour la sÃ©rialisation
  - Gestion centralisÃ©e des erreurs avec @ControllerAdvice

Persistance des donnÃ©es :
  - Base H2 en mode fichier (non in-memory)
  - Une base par hÃ´tel (hotellerie-paris-db, hotellerie-lyon-db, etc.)
  - Tables : chambres, reservations
  - Synchronisation automatique au dÃ©marrage

IdÃ©es clÃ©s du projet :
  1. Architecture microservices : chaque module est indÃ©pendant
  2. AgrÃ©gation multi-sources : les agences combinent plusieurs hÃ´tels
  3. Coefficients dynamiques : chaque agence applique sa marge (1.10 Ã  1.25)
  4. Persistance des donnÃ©es : les rÃ©servations survivent aux redÃ©marrages
  5. Interface utilisateur moderne : GUI Swing intuitive



2. L'HÃ”TEL
================================================================================

2.1 Logique mÃ©tier
------------------

Un hÃ´tel est une entitÃ© autonome qui :
  - PossÃ¨de une identitÃ© (nom, adresse, nombre d'Ã©toiles)
  - GÃ¨re un inventaire de chambres avec leurs caractÃ©ristiques
  - Stocke les rÃ©servations dans sa propre base de donnÃ©es
  - VÃ©rifie la disponibilitÃ© en temps rÃ©el

ModÃ¨les de donnÃ©es :

  Hotel {
    Long id
    String nom
    String adresse
    int etoiles
  }

  Chambre {
    Long id
    int numero
    double prixParNuit
    int nombreLits
    String imageUrl
    Hotel hotel
  }

  Reservation {
    Long id
    Chambre chambre
    Date dateArrivee
    Date dateDepart
    String nomClient
    String prenomClient
  }

RÃ¨gles mÃ©tier :
  - Une chambre ne peut avoir qu'une seule rÃ©servation active par pÃ©riode
  - Les dates de rÃ©servation doivent Ãªtre cohÃ©rentes (arrivÃ©e < dÃ©part)
  - Le systÃ¨me vÃ©rifie les chevauchements de dates
  - Les prix sont dÃ©finis au niveau de chaque chambre

Algorithme de recherche de chambres disponibles :
  1. Filtrer par adresse de l'hÃ´tel
  2. Pour chaque chambre :
     a. VÃ©rifier que le prix est dans la fourchette demandÃ©e
     b. VÃ©rifier que le nombre de lits correspond
     c. Interroger la BDD pour vÃ©rifier l'absence de rÃ©servation conflictuelle
  3. Retourner uniquement les chambres disponibles

L'algorithme de dÃ©tection de conflit vÃ©rifie :
  dateArriveeReservation <= dateDepart && dateDepartReservation >= dateArrivee


2.2 Implementation REST
------------------------

ContrÃ´leur principal : HotelController

Endpoints exposÃ©s :

  GET /api/hotel/info
    â†’ Retourne les informations de l'hÃ´tel (nom, adresse, Ã©toiles)
    RÃ©ponse : HotelInfoDTO

  POST /api/hotel/chambres/rechercher
    Body : {
      "adresse": "Lyon",
      "dateArrivee": "2025-12-01",
      "dateDepart": "2025-12-05",
      "prixMin": 0.0,
      "prixMax": 200.0,
      "nombreLits": 2
    }
    â†’ Recherche les chambres disponibles selon les critÃ¨res
    RÃ©ponse : List<ChambreDTO>

  POST /api/hotel/reservations/creer
    Body : {
      "chambreId": 1,
      "dateArrivee": "2025-12-01",
      "dateDepart": "2025-12-05",
      "nomClient": "Dupont",
      "prenomClient": "Jean"
    }
    â†’ CrÃ©e une nouvelle rÃ©servation
    RÃ©ponse : ReservationResponse { success, reservationId, message }

  GET /api/hotel/chambres/reservees
    â†’ Liste toutes les chambres actuellement rÃ©servÃ©es
    RÃ©ponse : List<ChambreReserveeDTO>

  GET /api/hotel/images/{imageId}
    â†’ Retourne l'image d'une chambre
    RÃ©ponse : byte[] (image JPEG/PNG)

Gestion des erreurs :
  - 200 OK : SuccÃ¨s
  - 400 Bad Request : DonnÃ©es invalides
  - 404 Not Found : Chambre non trouvÃ©e
  - 409 Conflict : Chambre dÃ©jÃ  rÃ©servÃ©e sur cette pÃ©riode

Configuration multi-instances :
  Chaque hÃ´tel dÃ©marre avec un profil Spring diffÃ©rent :
    - paris : port 8082, base hotellerie-paris-db
    - lyon : port 8083, base hotellerie-lyon-db
    - montpellier : port 8084, base hotellerie-montpellier-db

  Fichiers application-{profil}.properties :
    server.port=8082
    spring.application.name=Hotel-Paris
    spring.datasource.url=jdbc:h2:file:./data/hotellerie-paris-db
    hotel.nom=HÃ´tel de Paris
    hotel.adresse=Paris
    hotel.etoiles=4

Initialisation des donnÃ©es :
  Au dÃ©marrage, le HotelService :
  1. CrÃ©e l'hÃ´tel s'il n'existe pas dans la BDD
  2. VÃ©rifie et crÃ©e les chambres par dÃ©faut
  3. Charge toutes les rÃ©servations existantes
  4. Les donnÃ©es persistent entre les redÃ©marrages



3. L'AGENCE
================================================================================

3.1 UtilitÃ©
-----------

L'agence joue un rÃ´le d'agrÃ©gateur et d'intermÃ©diaire :

Fonctions principales :
  1. AGRÃ‰GATION : Interroge plusieurs hÃ´tels simultanÃ©ment
  2. UNIFICATION : PrÃ©sente une API unique au client
  3. TARIFICATION : Applique son propre coefficient de marge
  4. ROUTAGE : Redirige les rÃ©servations vers le bon hÃ´tel

Architecture multi-agences :
  Le systÃ¨me supporte plusieurs agences en parallÃ¨le, chacune avec :
    - Ses propres connexions aux hÃ´tels
    - Son coefficient tarifaire (1.10 Ã  1.25)
    - Son port d'Ã©coute distinct

  Exemple de configuration :
    AGENCE 1 "Paris Voyages" (port 8081, coef 1.15)
      â”œâ”€> HÃ´tel Paris (8082)
      â””â”€> HÃ´tel Lyon (8083)

    AGENCE 2 "Sud RÃ©servations" (port 8085, coef 1.20)
      â”œâ”€> HÃ´tel Lyon (8083) [partagÃ©]
      â””â”€> HÃ´tel Montpellier (8084)

Avantages de cette architecture :
  - Le client voit TOUTES les chambres de tous les hÃ´tels connectÃ©s
  - Les hÃ´tels partagÃ©s (Lyon) apparaissent via plusieurs agences
  - Chaque agence peut avoir sa politique tarifaire
  - RÃ©silience : si une agence tombe, les autres restent fonctionnelles


3.2 Implementation REST
------------------------

ContrÃ´leur principal : AgenceController

Endpoints exposÃ©s :

  GET /api/agence/ping
    â†’ VÃ©rifier que l'agence est opÃ©rationnelle
    RÃ©ponse : { "message": "Agence REST opÃ©rationnelle", "status": "OK" }

  POST /api/agence/chambres/rechercher
    Body : RechercheRequest {
      "adresse": "Lyon",
      "dateArrivee": "2025-12-01",
      "dateDepart": "2025-12-05",
      "prixMin": 0.0,
      "prixMax": 300.0,
      "nombreLits": 2
    }
    â†’ Recherche agrÃ©gÃ©e dans tous les hÃ´tels connectÃ©s
    RÃ©ponse : List<ChambreDTO> avec champ "agenceNom"

  POST /api/agence/reserver
    Body : ReservationRequest {
      "hotelUrl": "http://localhost:8082",
      "chambreId": 1,
      "dateArrivee": "2025-12-01",
      "dateDepart": "2025-12-05",
      "nomClient": "Dupont",
      "prenomClient": "Jean"
    }
    â†’ DÃ©lÃ¨gue la rÃ©servation Ã  l'hÃ´tel concernÃ©
    RÃ©ponse : ReservationResponse

  GET /api/agence/chambres/reservees
    â†’ Liste de toutes les chambres rÃ©servÃ©es via cette agence
    RÃ©ponse : List<ChambreReserveeDTO>

Service AgenceService - Logique d'agrÃ©gation :

  MÃ©thode rechercherChambres() :
    1. Pour chaque hÃ´tel connectÃ© (en parallÃ¨le via threads) :
       a. Appeler l'API REST de l'hÃ´tel
       b. RÃ©cupÃ©rer la liste des chambres disponibles
       c. Appliquer le coefficient tarifaire de l'agence
       d. Ajouter le nom de l'agence Ã  chaque chambre
    2. Fusionner toutes les rÃ©ponses dans une seule liste
    3. Retourner au client

  MÃ©thode reserver() :
    1. Extraire l'URL de l'hÃ´tel depuis la requÃªte
    2. Appeler l'API REST de l'hÃ´tel pour crÃ©er la rÃ©servation
    3. Retourner la rÃ©ponse (succÃ¨s/Ã©chec)

Client REST : MultiHotelRestClient
  - Utilise RestTemplate de Spring
  - Configuration des URLs des hÃ´tels dans application.properties
  - Gestion des timeouts et erreurs de connexion
  - Conversion automatique JSON <-> Java (Jackson)

Configuration application.properties :

  # Agence 1 - Paris Voyages
  server.port=8081
  agence.nom=Paris Voyages
  agence.coefficient=1.15
  hotel.paris.url=http://localhost:8082
  hotel.lyon.url=http://localhost:8083

  # Agence 2 - Sud RÃ©servations
  server.port=8085
  agence.nom=Sud RÃ©servations
  agence.coefficient=1.20
  hotel.lyon.url=http://localhost:8083
  hotel.montpellier.url=http://localhost:8084



4. CLIENT
================================================================================

4.1 FonctionnalitÃ©s
-------------------

Le client est une application graphique (Swing) offrant :

FonctionnalitÃ©s principales :
  1. RECHERCHE DE CHAMBRES
     - Saisie des critÃ¨res (ville, dates, prix, lits)
     - Affichage des rÃ©sultats dans un tableau
     - Indication de l'agence et de l'hÃ´tel pour chaque chambre
     - Prix ajustÃ©s avec le coefficient de l'agence

  2. RÃ‰SERVATION
     - SÃ©lection d'une chambre dans le tableau
     - Saisie des informations client (nom, prÃ©nom)
     - Validation et confirmation de la rÃ©servation
     - Affichage du numÃ©ro de rÃ©servation

  3. CONSULTATION DES RÃ‰SERVATIONS
     - Liste des chambres dÃ©jÃ  rÃ©servÃ©es
     - Filtrage par hÃ´tel
     - Informations dÃ©taillÃ©es (dates, client)

  4. VISUALISATION DES IMAGES
     - Chaque chambre a une image associÃ©e
     - Clic sur l'icÃ´ne pour agrandir l'image
     - Images servies par les hÃ´tels en HTTP

  5. MULTI-AGENCES
     - Connexion simultanÃ©e Ã  plusieurs agences
     - Fusion des rÃ©sultats dans une vue unique
     - Indication de l'agence source pour chaque offre

Interface utilisateur :
  - Barre de menu : Fichier, Actions, Aide
  - Panel de recherche : formulaire avec tous les critÃ¨res
  - Tableau de rÃ©sultats : colonnes triables
  - Console de logs : affichage des opÃ©rations en temps rÃ©el
  - Barre de statut : indicateur de connexion aux agences


4.2 Implementation REST
------------------------

Classe principale : ClientGUI (Swing) + MultiAgenceRestClient

MultiAgenceRestClient - Client REST multi-agences :

  Configuration :
    @Value("${agence1.url}") private String agence1Url;  // http://localhost:8081
    @Value("${agence2.url}") private String agence2Url;  // http://localhost:8085

  MÃ©thode rechercherChambres() :
    1. CrÃ©er le RechercheRequest avec les critÃ¨res
    2. Pour chaque agence :
       a. POST vers /api/agence/chambres/rechercher
       b. RÃ©cupÃ©rer List<ChambreDTO>
       c. Marquer chaque chambre avec le nom de l'agence
    3. Fusionner toutes les chambres dans une seule liste
    4. Retourner au GUI

  MÃ©thode reserver() :
    1. Identifier l'agence de la chambre sÃ©lectionnÃ©e
    2. POST vers /api/agence/reserver de l'agence concernÃ©e
    3. Traiter ReservationResponse
    4. Afficher le rÃ©sultat (succÃ¨s/erreur)

  MÃ©thode getChambresReservees() :
    1. Pour chaque agence :
       GET /api/agence/chambres/reservees
    2. Fusionner les rÃ©sultats
    3. Retourner la liste complÃ¨te

  MÃ©thode testConnexion() :
    Pour chaque agence : GET /api/agence/ping
    Affiche le statut de connexion dans l'interface

ClientGUI - Interface Swing :

  Composants principaux :
    - JTable avec DefaultTableModel pour les rÃ©sultats
    - JTextField pour les critÃ¨res de recherche
    - JTextArea pour la console de logs
    - JButton pour les actions (rechercher, rÃ©server)
    - JLabel pour le statut

  Listeners d'Ã©vÃ©nements :
    - ActionListener sur les boutons
    - MouseListener sur le tableau (double-clic pour rÃ©server)
    - WindowListener pour fermeture propre

  Gestion des threads :
    - SwingUtilities.invokeLater() pour les updates UI
    - Appels REST dans des threads sÃ©parÃ©s pour ne pas bloquer l'interface
    - Logs horodatÃ©s avec SimpleDateFormat

  Affichage des images :
    - IcÃ´ne "ğŸ–¼ï¸" dans le tableau
    - Clic sur l'icÃ´ne : tÃ©lÃ©chargement de l'image via HTTP
    - Affichage dans une JDialog avec JLabel contenant ImageIcon
    - Mise en cache des images tÃ©lÃ©chargÃ©es

Configuration application.properties :

  spring.application.name=Client
  spring.main.web-application-type=none
  java.awt.headless=false

  # URLs REST des agences
  agence1.url=http://localhost:8081
  agence2.url=http://localhost:8085



5. INTERFACES
================================================================================

5.1 Interface Client
--------------------

L'interface graphique (Swing) est organisÃ©e en plusieurs zones :

ZONE SUPÃ‰RIEURE - Panneau de recherche
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  [Adresse: Lyon  ]  [ArrivÃ©e: 2025-12-01]  [DÃ©part: 2025-12-05]â”‚
  â”‚  [Prix min: 0   ]  [Prix max: 300      ]  [Ã‰toiles: 4        ] â”‚
  â”‚  [Nombre de lits: 2]                      [RECHERCHER]          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ZONE CENTRALE - Tableau des rÃ©sultats
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ NÂ° â”‚ HÃ´tel    â”‚ Ville â”‚ Prix  â”‚ Lits â”‚ Agence        â”‚ Image  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 101â”‚ Paris    â”‚ Paris â”‚ 150â‚¬  â”‚  2   â”‚ Paris Voyages â”‚  ğŸ–¼ï¸   â”‚
  â”‚ 201â”‚ Lyon     â”‚ Lyon  â”‚ 120â‚¬  â”‚  2   â”‚ Paris Voyages â”‚  ğŸ–¼ï¸   â”‚
  â”‚ 201â”‚ Lyon     â”‚ Lyon  â”‚ 144â‚¬  â”‚  2   â”‚ Sud RÃ©sas     â”‚  ğŸ–¼ï¸   â”‚
  â”‚ 301â”‚ Montpel. â”‚ Montp.â”‚ 100â‚¬  â”‚  2   â”‚ Sud RÃ©sas     â”‚  ğŸ–¼ï¸   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Double-clic sur une ligne pour rÃ©server

ZONE INFÃ‰RIEURE - Console et statut
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ [12:30:15] ğŸ” Recherche de chambres...                          â”‚
  â”‚ [12:30:15]    CritÃ¨res: adresse=Lyon, dates=2025-12-01 â†’ 05    â”‚
  â”‚ [12:30:16]    RÃ©ponse reÃ§ue: 3 chambre(s)                       â”‚
  â”‚ [12:30:16] âœ“ 3 chambres trouvÃ©es                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Statut: âœ“ Connexion Ã©tablie: Paris Voyages | Sud RÃ©servations  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MENU
  Fichier
    â””â”€ Quitter

  Actions
    â”œâ”€ Rechercher des chambres
    â”œâ”€ Voir les rÃ©servations
    â””â”€ Tester la connexion

  Aide
    â””â”€ Ã€ propos

Workflow utilisateur :
  1. Lancer l'application (./start-client-clean.sh)
  2. VÃ©rifier la connexion (Status bar affiche les agences connectÃ©es)
  3. Saisir les critÃ¨res de recherche
  4. Cliquer sur "RECHERCHER"
  5. Consulter les rÃ©sultats dans le tableau
  6. (Optionnel) Cliquer sur ğŸ–¼ï¸ pour voir l'image de la chambre
  7. Double-cliquer sur une chambre pour la rÃ©server
  8. Saisir nom et prÃ©nom du client
  9. Confirmer la rÃ©servation
  10. Noter le numÃ©ro de rÃ©servation affichÃ©


5.2 Image et console
--------------------

SYSTÃˆME D'IMAGES

Chaque chambre est associÃ©e Ã  une image stockÃ©e dans le dossier :
  Hotellerie/Image/
    â”œâ”€â”€ Hotelle1.png  (HÃ´tel Paris)
    â”œâ”€â”€ Hotelle2.png  (HÃ´tel Lyon)
    â””â”€â”€ Hotelle3.png  (HÃ´tel Montpellier)

Mapping des images :
  - Toutes les chambres d'un mÃªme hÃ´tel partagent la mÃªme image
  - L'URL de l'image est stockÃ©e dans la base H2 (champ imageUrl)
  - Format : http://localhost:{port}/api/hotel/images/{imageId}

Serveur d'images :
  GET /api/hotel/images/{imageId}
    1. Lire le fichier depuis Hotellerie/Image/
    2. Retourner en byte[] avec Content-Type: image/png
    3. Le client tÃ©lÃ©charge et affiche dans une JDialog

Affichage dans l'interface :
  - Colonne "Image" du tableau : icÃ´ne ğŸ–¼ï¸ cliquable
  - MouseListener dÃ©tecte le clic
  - TÃ©lÃ©chargement de l'image via RestTemplate
  - CrÃ©ation d'une JDialog modale avec :
    * Titre : "Chambre {numero} - {hotel}"
    * JLabel contenant ImageIcon (image redimensionnÃ©e)
    * Bouton "Fermer"

CONSOLE DE LOGS

La console affiche en temps rÃ©el toutes les opÃ©rations :

Format des logs :
  [HH:mm:ss] {icÃ´ne} {message}

IcÃ´nes utilisÃ©s :
  âœ“  SuccÃ¨s (opÃ©ration rÃ©ussie)
  âœ—  Erreur (Ã©chec de l'opÃ©ration)
  ğŸ” Recherche en cours
  ğŸ“ RÃ©servation en cours
  âš   Avertissement
  â„¹ï¸  Information

Exemples de logs :
  [12:30:15] ğŸ” Recherche de chambres...
  [12:30:15]    CritÃ¨res: adresse=Lyon, dates=2025-12-01 â†’ 2025-12-05
  [12:30:15]    Appel du client REST...
  [12:30:16]    RÃ©ponse reÃ§ue: 3 chambre(s)
  [12:30:16] âœ“ 3 chambres trouvÃ©es

  [12:31:20] ğŸ“ RÃ©servation en cours...
  [12:31:20]    Chambre: 201 - HÃ´tel Lyon - 120.00â‚¬
  [12:31:20]    Client: Jean Dupont
  [12:31:20]    Dates: 2025-12-01 â†’ 2025-12-05
  [12:31:21] âœ“ RÃ©servation confirmÃ©e (ID: 15)

  [12:32:00] âœ— RÃ©servation Ã©chouÃ©e: Chambre dÃ©jÃ  rÃ©servÃ©e sur cette pÃ©riode

FonctionnalitÃ©s de la console :
  - Auto-scroll vers le bas
  - Limite de 1000 lignes (Ã©vite surcharge mÃ©moire)
  - Copie possible (Ctrl+C)
  - Police monospace pour alignement



6. BDD H2
================================================================================

6.1 Structure de la BDD
------------------------

Le systÃ¨me utilise H2, une base de donnÃ©es embarquÃ©e Java.

Configuration :
  Mode : FILE (persistance sur disque, pas in-memory)
  Localisation : Hotellerie/data/
  Fichiers : hotellerie-{ville}-db.mv.db

Bases de donnÃ©es crÃ©Ã©es :
  - hotellerie-paris-db.mv.db       (HÃ´tel Paris, port 8082)
  - hotellerie-lyon-db.mv.db        (HÃ´tel Lyon, port 8083)
  - hotellerie-montpellier-db.mv.db (HÃ´tel Montpellier, port 8084)

Connexion JDBC :
  spring.datasource.url=jdbc:h2:file:./data/hotellerie-paris-db
  spring.datasource.driverClassName=org.h2.Driver
  spring.datasource.username=sa
  spring.datasource.password=
  spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
  spring.jpa.hibernate.ddl-auto=update

SCHÃ‰MA DE LA BASE DE DONNÃ‰ES

Table HOTEL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (PK)    â”‚ nom      â”‚ adresse  â”‚ etoiles  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BIGINT     â”‚ VARCHAR  â”‚ VARCHAR  â”‚ INT      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Table CHAMBRE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (PK)    â”‚ numero â”‚ prix_nuit  â”‚ nombre_litsâ”‚ image_url â”‚ hotel_id   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BIGINT     â”‚ INT    â”‚ DOUBLE     â”‚ INT        â”‚ VARCHAR   â”‚ BIGINT (FK)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Table RESERVATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (PK)    â”‚ date_arriveeâ”‚ date_depart  â”‚ nom_client â”‚ prenom_cl â”‚ chambre_id â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BIGINT     â”‚ DATE        â”‚ DATE         â”‚ VARCHAR    â”‚ VARCHAR   â”‚ BIGINT (FK)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relations :
  HOTEL 1 â”€â”€< N CHAMBRE    (Un hÃ´tel a plusieurs chambres)
  CHAMBRE 1 â”€â”€< N RESERVATION  (Une chambre peut avoir plusieurs rÃ©servations)

Index :
  - PRIMARY KEY sur tous les id
  - FOREIGN KEY chambre.hotel_id â†’ hotel.id
  - FOREIGN KEY reservation.chambre_id â†’ chambre.id
  - INDEX sur reservation.date_arrivee et reservation.date_depart


6.2 RequÃªtes principales
-------------------------

REPOSITORY JPA

HotelRepository :
  @Repository
  public interface HotelRepository extends JpaRepository<Hotel, Long> {
      Optional<Hotel> findByNom(String nom);
  }

ChambreRepository :
  @Repository
  public interface ChambreRepository extends JpaRepository<Chambre, Long> {
      List<Chambre> findByHotel(Hotel hotel);

      @Query("SELECT c FROM Chambre c WHERE c.hotel = :hotel " +
             "AND c.id NOT IN (" +
             "  SELECT r.chambre.id FROM Reservation r " +
             "  WHERE r.dateArrivee <= :dateDepart " +
             "  AND r.dateDepart >= :dateArrivee" +
             ")")
      List<Chambre> findChambresDisponibles(
          @Param("hotel") Hotel hotel,
          @Param("dateArrivee") Date dateArrivee,
          @Param("dateDepart") Date dateDepart
      );
  }

ReservationRepository :
  @Repository
  public interface ReservationRepository extends JpaRepository<Reservation, Long> {
      List<Reservation> findByChambre(Chambre chambre);

      @Query("SELECT r FROM Reservation r " +
             "WHERE r.chambre = :chambre " +
             "AND r.dateArrivee <= :dateDepart " +
             "AND r.dateDepart >= :dateArrivee")
      List<Reservation> findConflictingReservations(
          @Param("chambre") Chambre chambre,
          @Param("dateArrivee") Date dateArrivee,
          @Param("dateDepart") Date dateDepart
      );

      @Query("SELECT r FROM Reservation r WHERE r.chambre.hotel = :hotel")
      List<Reservation> findByHotel(@Param("hotel") Hotel hotel);
  }

REQUÃŠTES PRINCIPALES EXÃ‰CUTÃ‰ES

1. Recherche de chambres disponibles :
   SELECT c.* FROM CHAMBRE c
   WHERE c.hotel_id = ?
   AND c.prix_nuit BETWEEN ? AND ?
   AND c.nombre_lits >= ?
   AND c.id NOT IN (
     SELECT r.chambre_id FROM RESERVATION r
     WHERE r.date_arrivee <= ?
     AND r.date_depart >= ?
   )

2. CrÃ©ation d'une rÃ©servation :
   INSERT INTO RESERVATION
   (date_arrivee, date_depart, nom_client, prenom_client, chambre_id)
   VALUES (?, ?, ?, ?, ?)

3. VÃ©rification des conflits :
   SELECT COUNT(*) FROM RESERVATION
   WHERE chambre_id = ?
   AND date_arrivee <= ?
   AND date_depart >= ?

4. Liste des chambres rÃ©servÃ©es :
   SELECT c.*, r.* FROM CHAMBRE c
   JOIN RESERVATION r ON c.id = r.chambre_id
   WHERE c.hotel_id = ?
   ORDER BY r.date_arrivee DESC

5. Initialisation de l'hÃ´tel au dÃ©marrage :
   SELECT * FROM HOTEL WHERE nom = ?
   (Si absent) INSERT INTO HOTEL (nom, adresse, etoiles) VALUES (?, ?, ?)

6. Initialisation des chambres :
   SELECT * FROM CHAMBRE WHERE hotel_id = ? AND numero = ?
   (Si absent) INSERT INTO CHAMBRE (numero, prix_nuit, nombre_lits, image_url, hotel_id)
   VALUES (?, ?, ?, ?, ?)

GESTION DES TRANSACTIONS

  @Transactional sur les mÃ©thodes de service :
    - rechercherChambres() : READ_ONLY
    - creerReservation() : READ_WRITE (isolation REPEATABLE_READ)
    - getChambresReservees() : READ_ONLY

  Propagation :
    - REQUIRED : utilise la transaction existante ou en crÃ©e une
    - Rollback automatique en cas d'exception

PERSISTANCE ET COHÃ‰RENCE

  Au dÃ©marrage de chaque hÃ´tel :
    1. VÃ©rifier l'existence de l'hÃ´tel dans la BDD
    2. CrÃ©er l'hÃ´tel si nÃ©cessaire
    3. VÃ©rifier et crÃ©er les chambres par dÃ©faut
    4. Les rÃ©servations existantes sont automatiquement chargÃ©es

  Lors d'une rÃ©servation :
    1. VÃ©rifier que la chambre existe
    2. VÃ©rifier l'absence de conflit (requÃªte SQL)
    3. CrÃ©er la rÃ©servation (INSERT)
    4. Commit de la transaction

  Lors d'un redÃ©marrage :
    - Les fichiers .mv.db sont conservÃ©s
    - Toutes les rÃ©servations sont toujours prÃ©sentes
    - Aucune perte de donnÃ©es



7. Ã‰VOLUTION
================================================================================

Ã‰volution du projet : SOAP â†’ REST

PHASE 1 : Architecture SOAP initiale
  - Web Services SOAP avec WSDL
  - Messages XML avec JAXB
  - Spring-WS pour le serveur
  - ComplexitÃ© : gÃ©nÃ©ration de classes, namespaces XML

PHASE 2 : Migration vers REST
  - Remplacement des endpoints SOAP par @RestController
  - Messages JSON (plus lÃ©gers que XML)
  - RestTemplate pour les clients
  - Simplification : pas de gÃ©nÃ©ration de code

PHASE 3 : Ajout de la persistance H2
  - Remplacement de la mÃ©moire volatile
  - Spring Data JPA pour l'ORM
  - Bases de donnÃ©es par hÃ´tel
  - Conservation des rÃ©servations

PHASE 4 : Interface graphique Swing
  - Remplacement du client CLI
  - Visualisation des images
  - Console de logs en temps rÃ©el
  - ExpÃ©rience utilisateur moderne

PHASE 5 : Multi-agences avec coefficients
  - Support de plusieurs agences simultanÃ©es
  - Coefficients tarifaires dynamiques
  - AgrÃ©gation de rÃ©sultats
  - HÃ´tels partagÃ©s entre agences

AmÃ©liorations possibles futures :

  1. SÃ‰CURITÃ‰
     - Authentification JWT pour les APIs
     - HTTPS pour les communications
     - Hachage des mots de passe clients
     - Rate limiting sur les endpoints

  2. PERFORMANCE
     - Cache Redis pour les rÃ©sultats de recherche
     - Pagination des rÃ©sultats (Ã©viter de charger 1000+ chambres)
     - Appels REST asynchrones avec CompletableFuture
     - Pool de connexions HTTP optimisÃ©

  3. FONCTIONNALITÃ‰S
     - Modification de rÃ©servation
     - Annulation de rÃ©servation
     - Historique des rÃ©servations client
     - SystÃ¨me de points de fidÃ©litÃ©
     - Recherche par catÃ©gorie de chambre (standard, suite, etc.)
     - Filtrage par Ã©quipements (wifi, parking, etc.)

  4. MONITORING
     - Actuator Spring Boot pour healthchecks
     - MÃ©triques Prometheus
     - Logs centralisÃ©s (ELK stack)
     - Alertes en cas de panne

  5. DÃ‰PLOIEMENT
     - Containerisation Docker
     - Orchestration Kubernetes
     - CI/CD avec Jenkins/GitLab CI
     - Base de donnÃ©es externe (PostgreSQL, MySQL)

  6. TESTS
     - Tests unitaires (JUnit 5)
     - Tests d'intÃ©gration (MockMvc)
     - Tests de charge (JMeter, Gatling)
     - Tests end-to-end (Selenium)

  7. DOCUMENTATION
     - Swagger UI complet avec exemples
     - Postman collections
     - Guide d'architecture dÃ©taillÃ©
     - Diagrammes UML/C4



8. CONCLUSION
================================================================================

RÃ‰SUMÃ‰ DU PROJET

Ce projet implÃ©mente un systÃ¨me complet de rÃ©servation hÃ´teliÃ¨re multi-agences
basÃ© sur une architecture REST moderne et distribuÃ©e.

Points forts de l'architecture :
  âœ“ Microservices indÃ©pendants (HÃ´tels, Agences, Client)
  âœ“ Communication REST/JSON standardisÃ©e
  âœ“ Persistance des donnÃ©es avec H2
  âœ“ Interface graphique intuitive (Swing)
  âœ“ Support multi-agences avec agrÃ©gation
  âœ“ Gestion des images des chambres
  âœ“ Logs en temps rÃ©el
  âœ“ Scripts de dÃ©marrage automatisÃ©s

Points techniques notables :
  âœ“ Spring Boot 2.7.18 pour l'infrastructure
  âœ“ Spring Data JPA pour la persistance
  âœ“ RestTemplate pour les communications
  âœ“ Swagger/OpenAPI pour la documentation
  âœ“ H2 en mode fichier (persistance)
  âœ“ Maven pour la gestion des dÃ©pendances

Organisation du projet :
  âœ“ 3 modules Maven : Hotellerie, Agence, Client
  âœ“ 4 scripts essentiels pour l'exploitation
  âœ“ 33 scripts archivÃ©s pour rÃ©fÃ©rence
  âœ“ 61 documentations dÃ©taillÃ©es
  âœ“ Structure claire et maintenable

STATISTIQUES

  Lignes de code :
    - Hotellerie : ~2500 lignes Java
    - Agence : ~1800 lignes Java
    - Client : ~1500 lignes Java
    Total : ~5800 lignes Java

  APIs REST exposÃ©es :
    - HÃ´tel : 5 endpoints
    - Agence : 4 endpoints
    Total : 9 endpoints par instance

  Base de donnÃ©es :
    - 3 bases H2 (une par hÃ´tel)
    - 3 tables par base (hotel, chambre, reservation)
    - Relations 1-N gÃ©rÃ©es par JPA

  Ports utilisÃ©s :
    - 8081 : Agence Paris Voyages
    - 8082 : HÃ´tel Paris
    - 8083 : HÃ´tel Lyon
    - 8084 : HÃ´tel Montpellier
    - 8085 : Agence Sud RÃ©servations

DÃ‰MARRAGE DU SYSTÃˆME

  Commande unique pour dÃ©marrer tout le systÃ¨me :
    ./rest-persistant.sh

  Puis dans un autre terminal :
    ./start-client-clean.sh

  Le systÃ¨me est opÃ©rationnel en ~20 secondes.

UTILISATION

  1. L'interface graphique se lance automatiquement
  2. La barre de statut indique la connexion aux agences
  3. L'utilisateur peut rechercher des chambres par critÃ¨res
  4. Les rÃ©sultats affichent toutes les chambres disponibles
  5. Un double-clic permet de rÃ©server une chambre
  6. La rÃ©servation est persistÃ©e dans la base H2
  7. Les donnÃ©es survivent aux redÃ©marrages

MAINTENANCE

  Scripts disponibles :
    - rest-persistant.sh : RedÃ©marrage avec conservation des donnÃ©es
    - fix-complete.sh : Reset complet (efface les BDD)
    - arreter-services.sh : ArrÃªt propre de tous les services
    - start-client-clean.sh : Lancement du client GUI

  Logs :
    - Dossier logs/ : un fichier par service
    - Console GUI : logs en temps rÃ©el cÃ´tÃ© client
    - Stdout des services : visible pendant le dÃ©marrage

BILAN

Le projet dÃ©montre une maÃ®trise des technologies suivantes :
  â˜‘ Architecture REST / Microservices
  â˜‘ Spring Boot et son Ã©cosystÃ¨me
  â˜‘ Persistance JPA/Hibernate
  â˜‘ Communication inter-services
  â˜‘ Interface graphique Swing
  â˜‘ Gestion des bases de donnÃ©es
  â˜‘ Scripts shell pour l'automatisation
  â˜‘ Organisation et documentation

Le systÃ¨me est fonctionnel, robuste et prÃªt pour une utilisation rÃ©elle.
Toutes les fonctionnalitÃ©s ont Ã©tÃ© testÃ©es et validÃ©es.

L'architecture modulaire permet des Ã©volutions futures sans refonte majeure.


================================================================================
                              FIN DU RAPPORT
================================================================================

Projet dÃ©veloppÃ© avec Spring Boot, H2, Swing et beaucoup de â˜•
Version REST - Novembre 2025

